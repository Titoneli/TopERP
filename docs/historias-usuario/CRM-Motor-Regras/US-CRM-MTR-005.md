# US-CRM-MTR-005: Simulacao, Teste e Debug de Regras

> **Modulo**: CRM-Motor-Regras  
> **Versao**: 2.0  
> **Data**: 29/01/2026  
> **Status**: Pronto para Desenvolvimento  
> **Story Points**: 34

---

## Historia de Usuario

**Como** usuario de negocio,  
**Quero** simular a execucao de regras com dados reais ou ficticios, depurar passo a passo e testar cenarios,  
**Para** validar que a regra funciona corretamente antes de ativa-la em producao.

---

## Descricao

Esta historia implementa:

1. **Simulador de Regras**: Execucao em modo sandbox
2. **Depurador Visual**: Execucao passo a passo
3. **Cenarios de Teste**: Casos pre-definidos
4. **Comparador de Versoes**: Diferenca entre versoes
5. **Modo What-If**: Alteracao de variaveis em tempo real

### Conceito de Simulacao

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SIMULACAO DE REGRA                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  Regra: REG-BONUS-SP-AUTO-001                                                   â”‚
â”‚  Versao: 1 (Rascunho)                                                           â”‚
â”‚                                                                                 â”‚
â”‚  ENTRADA                          â”‚  EXECUCAO                â”‚  RESULTADO       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  Consultor: Joao Silva            â”‚  â–¶ INICIO                â”‚                  â”‚
â”‚  Periodo: Janeiro/2026            â”‚  âœ“ placas_sp = 15        â”‚  Aplicada: SIM   â”‚
â”‚                                   â”‚  âœ“ meta = 10             â”‚  Bonus: R$4.000  â”‚
â”‚  [Dados Reais]                    â”‚  âœ“ pct_acima = 50%       â”‚                  â”‚
â”‚  [Dados Ficticios]                â”‚  âœ“ faixas = 5            â”‚  Tempo: 45ms     â”‚
â”‚                                   â”‚  âœ“ valor = 4000          â”‚                  â”‚
â”‚  [Simular]                        â”‚  âœ“ CONDICAO: TRUE        â”‚                  â”‚
â”‚                                   â”‚  âœ“ ACAO: CREDITAR        â”‚                  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Criterios de Aceitacao

### CA-001: Simulador com Dados Reais

- [ ] Selecionar consultor real do sistema
- [ ] Selecionar periodo de referencia
- [ ] Sistema busca dados reais dos Providers
- [ ] Executa regra em modo simulacao (sem persistir acoes)
- [ ] Exibe resultado detalhado
- [ ] Marca claramente como "SIMULACAO"

### CA-002: Simulador com Dados Ficticios

- [ ] Formulario para entrada de dados manuais
- [ ] Pre-preenche com valores de exemplo
- [ ] Permite alterar qualquer valor de entrada
- [ ] Executa com dados informados
- [ ] Nao acessa Providers reais
- [ ] Util para testar cenarios edge-case

**Exemplo de Entrada Ficticia:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DADOS FICTICIOS PARA SIMULACAO                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  VARIAVEIS DE AGREGACAO (valores manuais)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ placas_sp_auto_50k     â”‚  [15]                                          â”‚   â”‚
â”‚  â”‚ meta_mes               â”‚  [10]                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  CONTEXTO                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ consultor_id           â”‚  [550e8400-e29b-41d4-a716-446655440000]        â”‚   â”‚
â”‚  â”‚ periodo_inicio         â”‚  [2026-01-01]                                  â”‚   â”‚
â”‚  â”‚ periodo_fim            â”‚  [2026-01-31]                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  [Simular com Estes Dados]                                                     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CA-003: Depurador Visual (Step-by-Step)

- [ ] Botao "Depurar" inicia modo debug
- [ ] Executa uma variavel por vez
- [ ] Destaca variavel atual no editor visual/DSL
- [ ] Mostra valor calculado apos cada passo
- [ ] Botoes: Proximo, Anterior, Executar Tudo, Parar
- [ ] Breakpoints em variaveis especificas

**Interface de Debug:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEPURADOR DE REGRAS                              [â—€ Anterior] [â–¶ Proximo] [â– ]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  PASSO 3 de 7 | Variavel: pct_acima_meta                                       â”‚
â”‚                                                                                 â”‚
â”‚  VARIAVEIS                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ“ placas_sp_auto_50k  = 15          (AGREGACAO - 12ms)                  â”‚   â”‚
â”‚  â”‚ âœ“ meta_mes            = 10          (AGREGACAO - 5ms)                   â”‚   â”‚
â”‚  â”‚ â–¶ pct_acima_meta      = ?           (FORMULA)        â† Atual            â”‚   â”‚
â”‚  â”‚   faixas_10_pct       = pendente    (FORMULA)                           â”‚   â”‚
â”‚  â”‚   valor_bonus         = pendente    (FORMULA)                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  DETALHES DO PASSO ATUAL                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Tipo: FORMULA                                                           â”‚   â”‚
â”‚  â”‚ Expressao: GREATEST((placas_sp_auto_50k - meta_mes) / meta_mes * 100,0) â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚ Substituicao:                                                           â”‚   â”‚
â”‚  â”‚   GREATEST((15 - 10) / 10 * 100, 0)                                     â”‚   â”‚
â”‚  â”‚   = GREATEST(5 / 10 * 100, 0)                                           â”‚   â”‚
â”‚  â”‚   = GREATEST(0.5 * 100, 0)                                              â”‚   â”‚
â”‚  â”‚   = GREATEST(50, 0)                                                     â”‚   â”‚
â”‚  â”‚   = 50                                                                  â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚ Resultado: 50                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  [Adicionar Breakpoint] [Ver Query SQL] [Continuar ate Fim]                    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CA-004: Cenarios de Teste Pre-definidos

- [ ] Criar cenarios de teste salvos
- [ ] Cenario inclui dados de entrada e resultado esperado
- [ ] Executar todos os cenarios (suite de testes)
- [ ] Relatorio de passed/failed
- [ ] Historico de execucao de testes

**Gerenciamento de Cenarios:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CENARIOS DE TESTE                                          [+ Novo Cenario]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  Regra: REG-BONUS-SP-AUTO-001                                                   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ # â”‚ Cenario                        â”‚ Esperado      â”‚ Ultimo  â”‚ Status  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 1 â”‚ Consultor acima da meta (50%)  â”‚ Bonus: 4000   â”‚ 4000    â”‚ âœ“ PASS  â”‚   â”‚
â”‚  â”‚ 2 â”‚ Consultor exatamente na meta   â”‚ Sem bonus     â”‚ Sem     â”‚ âœ“ PASS  â”‚   â”‚
â”‚  â”‚ 3 â”‚ Consultor abaixo da meta       â”‚ Sem bonus     â”‚ Sem     â”‚ âœ“ PASS  â”‚   â”‚
â”‚  â”‚ 4 â”‚ Consultor 5% acima (edge case) â”‚ Sem bonus     â”‚ Sem     â”‚ âœ“ PASS  â”‚   â”‚
â”‚  â”‚ 5 â”‚ Consultor 10% acima            â”‚ Bonus: 800    â”‚ 800     â”‚ âœ“ PASS  â”‚   â”‚
â”‚  â”‚ 6 â”‚ Meta zero (divisao)            â”‚ Erro tratado  â”‚ Erro    â”‚ âœ“ PASS  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  [Executar Todos] [Exportar Relatorio]                                         â”‚
â”‚  Ultima execucao: 29/01/2026 14:35 | 6/6 passaram                              â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CA-005: Modo What-If (Analise de Sensibilidade)

- [ ] Alterar valor de variavel em tempo real
- [ ] Ver impacto imediato no resultado
- [ ] Slider para valores numericos
- [ ] Grafico de sensibilidade
- [ ] Identificar pontos de virada

**Interface What-If:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ANALISE WHAT-IF                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  Variavel de Analise: placas_sp_auto_50k                                       â”‚
â”‚                                                                                 â”‚
â”‚  Meta: 10 placas                                                               â”‚
â”‚                                                                                 â”‚
â”‚  VALOR       â”‚ % ACIMA â”‚ FAIXAS â”‚ BONUS    â”‚                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚   8          â”‚ 0%      â”‚ 0      â”‚ R$ 0     â”‚ â†                                  â”‚
â”‚   9          â”‚ 0%      â”‚ 0      â”‚ R$ 0     â”‚ â†                                  â”‚
â”‚  10          â”‚ 0%      â”‚ 0      â”‚ R$ 0     â”‚ â† Ponto de virada                  â”‚
â”‚  11          â”‚ 10%     â”‚ 1      â”‚ R$ 800   â”‚ â†                                  â”‚
â”‚  12          â”‚ 20%     â”‚ 2      â”‚ R$ 1.600 â”‚                                    â”‚
â”‚  15 â—        â”‚ 50%     â”‚ 5      â”‚ R$ 4.000 â”‚ â† Valor atual                      â”‚
â”‚  20          â”‚ 100%    â”‚ 10     â”‚ R$ 8.000 â”‚                                    â”‚
â”‚                                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  8            15                           30                                   â”‚
â”‚                                                                                 â”‚
â”‚  [Exportar Analise]                                                            â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CA-006: Comparador de Versoes

- [ ] Selecionar duas versoes para comparar
- [ ] Exibir diff lado a lado
- [ ] Destacar diferencas (adicionado, removido, alterado)
- [ ] Simular mesmos dados em ambas versoes
- [ ] Comparar resultados

### CA-007: Log de Simulacoes

- [ ] Registrar todas as simulacoes executadas
- [ ] Filtrar por regra, usuario, data
- [ ] Re-executar simulacao anterior
- [ ] Exportar log

---

## Mockups

### Tela: Simulador Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SIMULADOR DE REGRAS                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  Regra: [REG-BONUS-SP-AUTO-001 â–¼]  Versao: [1 - Rascunho â–¼]                        â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€ MODO DE SIMULACAO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ Dados Reais     â— Dados Ficticios     â—‹ Cenario de Teste                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â”‚  ENTRADA                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ placas_sp_auto_50k    â”‚ [15]                                                â”‚   â”‚
â”‚  â”‚ meta_mes              â”‚ [10]                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â”‚  [â–¶ Simular] [ðŸ” Depurar Passo-a-Passo] [ðŸ“Š Analise What-If]                        â”‚
â”‚                                                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                                     â”‚
â”‚  RESULTADO DA SIMULACAO                                               [Modo: Normal]â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                             â”‚   â”‚
â”‚  â”‚  Status: âœ“ REGRA APLICADA                                                   â”‚   â”‚
â”‚  â”‚                                                                             â”‚   â”‚
â”‚  â”‚  VARIAVEIS CALCULADAS                                                       â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚   â”‚
â”‚  â”‚  placas_sp_auto_50k  = 15                                                   â”‚   â”‚
â”‚  â”‚  meta_mes            = 10                                                   â”‚   â”‚
â”‚  â”‚  pct_acima_meta      = 50                                                   â”‚   â”‚
â”‚  â”‚  faixas_10_pct       = 5                                                    â”‚   â”‚
â”‚  â”‚  valor_bonus         = 4000                                                 â”‚   â”‚
â”‚  â”‚                                                                             â”‚   â”‚
â”‚  â”‚  CONDICAO                                                                   â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                 â”‚   â”‚
â”‚  â”‚  placas_sp_auto_50k (15) > meta_mes (10) = TRUE                             â”‚   â”‚
â”‚  â”‚  faixas_10_pct (5) >= 1 = TRUE                                              â”‚   â”‚
â”‚  â”‚  Resultado: TRUE (AND)                                                      â”‚   â”‚
â”‚  â”‚                                                                             â”‚   â”‚
â”‚  â”‚  ACOES SIMULADAS (nao persistidas)                                          â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚   â”‚
â”‚  â”‚  [1] ADICIONAR_VALOR: R$ 4.000,00 em BONUS                                  â”‚   â”‚
â”‚  â”‚                                                                             â”‚   â”‚
â”‚  â”‚  Tempo de execucao: 45ms                                                    â”‚   â”‚
â”‚  â”‚                                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â”‚  [Salvar como Cenario] [Exportar] [Executar Novamente]                             â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cenarios de Teste

### CT-001: Simulacao com Dados Reais

**Dado** regra REG-BONUS-SP-AUTO-001  
**E** consultor "Joao Silva" selecionado  
**E** periodo Janeiro/2026  
**Quando** clico em "Simular"  
**Entao** sistema busca dados reais do consultor  
**E** executa regra em modo simulacao  
**E** exibe resultado detalhado  
**E** nao persiste nenhuma acao

### CT-002: Depuracao Passo-a-Passo

**Dado** simulacao iniciada em modo debug  
**Quando** clico em "Proximo"  
**Entao** proxima variavel e calculada  
**E** valor exibido ao lado  
**E** destaque no editor visual/DSL  
**E** posso ver detalhes do calculo

### CT-003: Suite de Cenarios

**Dado** 6 cenarios de teste criados para regra  
**Quando** clico em "Executar Todos"  
**Entao** sistema executa os 6 cenarios  
**E** exibe resultado de cada um (pass/fail)  
**E** destaca cenarios que falharam  
**E** exibe diferenca entre esperado e obtido

### CT-004: Analise What-If

**Dado** resultado de simulacao exibido  
**Quando** abro analise what-if  
**E** altero valor de placas para 20  
**Entao** resultado atualizado em tempo real  
**E** bonus recalculado para R$ 8.000  
**E** grafico de sensibilidade exibido

---

## Regras de Negocio

| Codigo | Regra | Validacao |
|--------|-------|-----------|
| RN-001 | Simulacao nao persiste | Acoes apenas exibidas, nunca executadas |
| RN-002 | Log obrigatorio | Toda simulacao registrada |
| RN-003 | Cenarios reutilizaveis | Cenarios podem ser compartilhados |
| RN-004 | Dados ficticios isolados | Nao acessam banco de dados |
| RN-005 | Debug por permissao | Apenas usuarios autorizados |

---

## Estimativa Detalhada

| Item | Horas | SP |
|------|-------|-----|
| Simulador com Dados Reais | 24h | 8 |
| Simulador com Dados Ficticios | 16h | 5 |
| Depurador Visual | 32h | 8 |
| Cenarios de Teste | 24h | 5 |
| Modo What-If | 24h | 5 |
| Comparador de Versoes | 8h | 2 |
| Testes | 4h | 1 |
| **TOTAL** | **132h** | **34** |

---

## Historico de Alteracoes

| Versao | Data | Autor | Alteracao |
|--------|------|-------|-----------|
| 1.0 | 29/01/2026 | PO | Versao inicial |
| 2.0 | 29/01/2026 | PO | Reescrita para arquitetura de alta abstracao |
