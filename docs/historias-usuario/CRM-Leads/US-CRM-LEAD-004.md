# US-CRM-LEAD-004 â€” Captura via FormulÃ¡rio Embarcado

## HistÃ³ria de UsuÃ¡rio

**Como** parceiro ou afiliado da TopBrasil,  
**Quero** incorporar um formulÃ¡rio de captaÃ§Ã£o de leads em meu site ou blog,  
**Para** capturar leads interessados em proteÃ§Ã£o veicular e receber comissÃ£o por conversÃµes.

## Prioridade

Importante

## Estimativa

8 SP

---

## Contexto de NegÃ³cio

A captura via formulÃ¡rio embarcado permite expandir os canais de aquisiÃ§Ã£o de leads atravÃ©s de parceiros, afiliados e sites de terceiros. O formulÃ¡rio Ã© incorporado via iframe ou widget JavaScript, mantendo a identidade visual do parceiro enquanto envia os dados diretamente para o CRM TopBrasil.

### BenefÃ­cios

| BenefÃ­cio | DescriÃ§Ã£o |
|-----------|-----------|
| **Escalabilidade** | Multiplica pontos de captaÃ§Ã£o sem aumento de infraestrutura |
| **Rastreabilidade** | Cada parceiro tem cÃ³digo Ãºnico para mensuraÃ§Ã£o |
| **ConversÃ£o** | UsuÃ¡rio nÃ£o precisa sair do site do parceiro |
| **Comissionamento** | Base para programa de afiliados |

---

## Fluxo de IntegraÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SITE DO PARCEIRO                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    CONTEÃšDO DO PARCEIRO                       â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  "Proteja seu veÃ­culo com a TopBrasil!"                       â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              FORMULÃRIO EMBARCADO (iframe)              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Nome: [________________]                       â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Telefone: [________________]                   â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  E-mail: [________________]                     â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                                 â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  [      QUERO UMA COTAÃ‡ÃƒO      ]                â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ POST /api/leads/embed
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CRM TOPBRASIL                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   âœ“ Valida origem (CORS + token)                                    â”‚
â”‚   âœ“ Registra cod_origem = 12 (FORMULARIO_EMBARCADO)                 â”‚
â”‚   âœ“ Registra cod_parceiro (identificador do parceiro)               â”‚
â”‚   âœ“ Cria Lead com status NOVO                                       â”‚
â”‚   âœ“ Retorna confirmaÃ§Ã£o ao parceiro                                 â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Modos de IntegraÃ§Ã£o

### OpÃ§Ã£o 1: Iframe (Recomendado)

```html
<iframe 
  src="https://crm.toptechbr.com.br/embed/lead-form?token=PARCEIRO_TOKEN"
  width="100%" 
  height="400" 
  frameborder="0"
  style="border: none; border-radius: 8px;">
</iframe>
```

### OpÃ§Ã£o 2: Widget JavaScript

```html
<div id="topbrasil-lead-form"></div>
<script src="https://crm.toptechbr.com.br/embed/widget.js" 
        data-token="PARCEIRO_TOKEN"
        data-theme="light">
</script>
```

### OpÃ§Ã£o 3: API Direta (AvanÃ§ado)

```javascript
// POST https://crm.toptechbr.com.br/api/v1/leads/embed
{
  "token": "PARCEIRO_TOKEN",
  "lead": {
    "nome": "JoÃ£o da Silva",
    "telefone": "11999999999",
    "email": "joao@email.com"
  }
}
```

---

## ParÃ¢metros do FormulÃ¡rio

| ParÃ¢metro | DescriÃ§Ã£o | ObrigatÃ³rio | Exemplo |
|-----------|-----------|-------------|---------|
| `token` | Token Ãºnico do parceiro | Sim | `abc123xyz` |
| `theme` | Tema visual (light/dark) | NÃ£o | `light` |
| `color` | Cor primÃ¡ria do botÃ£o | NÃ£o | `#FF6600` |
| `redirect_url` | URL de redirecionamento pÃ³s-envio | NÃ£o | `https://parceiro.com/obrigado` |
| `callback_url` | Webhook para notificar conversÃ£o | NÃ£o | `https://parceiro.com/webhook` |

---

## Campos do FormulÃ¡rio Simplificado

| Campo | Tipo | ObrigatÃ³rio | ValidaÃ§Ã£o |
|-------|------|-------------|-----------|
| Nome Completo | text | Sim | MÃ­n. 3 caracteres |
| Telefone | tel | Sim | Formato brasileiro, DDD obrigatÃ³rio |
| E-mail | email | Sim | Formato vÃ¡lido |

> **Nota**: O formulÃ¡rio embarcado Ã© **simplificado** (apenas Etapa 1). O lead pode completar dados de veÃ­culo e localizaÃ§Ã£o posteriormente via link enviado por e-mail/WhatsApp.

---

## CritÃ©rios de AceitaÃ§Ã£o

### CenÃ¡rio 1 â€” Embed via iframe funcionando
- **Dado que** um parceiro incorporou o iframe em seu site
- **Quando** um visitante preenche nome, telefone e e-mail vÃ¡lidos
- **E** clica em "Quero uma CotaÃ§Ã£o"
- **EntÃ£o** o lead Ã© criado no CRM com `cod_origem = 12` (FORMULARIO_EMBARCADO)
- **E** o `cod_parceiro` Ã© registrado para rastreabilidade
- **E** exibe mensagem de sucesso no iframe

### CenÃ¡rio 2 â€” Embed via Widget JavaScript
- **Dado que** um parceiro incorporou o widget JS em seu site
- **Quando** o script carrega
- **EntÃ£o** o formulÃ¡rio Ã© renderizado no container especificado
- **E** respeita as configuraÃ§Ãµes de tema e cor

### CenÃ¡rio 3 â€” ValidaÃ§Ã£o de token
- **Dado que** o formulÃ¡rio Ã© carregado com um token invÃ¡lido
- **Quando** tento enviar os dados
- **EntÃ£o** recebo erro "Token de parceiro invÃ¡lido"
- **E** o lead nÃ£o Ã© criado

### CenÃ¡rio 4 â€” Token expirado ou parceiro inativo
- **Dado que** o parceiro estÃ¡ com status inativo
- **Quando** o formulÃ¡rio tenta enviar dados
- **EntÃ£o** recebo erro "Parceiro temporariamente indisponÃ­vel"
- **E** o lead nÃ£o Ã© criado

### CenÃ¡rio 5 â€” ValidaÃ§Ã£o de telefone
- **Dado que** informo um telefone jÃ¡ cadastrado como consultor
- **Quando** tento enviar o formulÃ¡rio
- **EntÃ£o** recebo erro "Este telefone jÃ¡ estÃ¡ cadastrado"
- **E** o lead nÃ£o Ã© criado

### CenÃ¡rio 6 â€” Redirecionamento pÃ³s-envio
- **Dado que** o parceiro configurou `redirect_url`
- **Quando** o lead Ã© criado com sucesso
- **EntÃ£o** o visitante Ã© redirecionado para a URL configurada

### CenÃ¡rio 7 â€” Webhook de notificaÃ§Ã£o
- **Dado que** o parceiro configurou `callback_url`
- **Quando** o lead Ã© criado com sucesso
- **EntÃ£o** uma notificaÃ§Ã£o POST Ã© enviada para o webhook
- **E** contÃ©m o ID do lead e timestamp

### CenÃ¡rio 8 â€” ProteÃ§Ã£o CORS
- **Dado que** uma requisiÃ§Ã£o vem de um domÃ­nio nÃ£o autorizado
- **Quando** tenta enviar dados via API
- **EntÃ£o** a requisiÃ§Ã£o Ã© bloqueada por CORS
- **E** retorna erro 403

---

## Regras de NegÃ³cio

| ID | Regra |
|----|-------|
| RN-001 | Token de parceiro Ã© obrigatÃ³rio e validado em todas as requisiÃ§Ãµes |
| RN-002 | Cada parceiro tem um token Ãºnico e intransferÃ­vel |
| RN-003 | Lead criado via embed recebe `cod_origem = 12` (FORMULARIO_EMBARCADO) |
| RN-004 | O `cod_parceiro` Ã© registrado para comissionamento futuro |
| RN-005 | ValidaÃ§Ã£o de telefone contra blacklist de consultores Ã© obrigatÃ³ria |
| RN-006 | DDD Ã© extraÃ­do e armazenado automaticamente |
| RN-007 | Parceiro inativo nÃ£o pode captar novos leads |
| RN-008 | Rate limiting: mÃ¡ximo 100 leads/hora por token |
| RN-009 | CORS configurado apenas para domÃ­nios autorizados do parceiro |
| RN-010 | Lead embarcado inicia com status `NOVO` e `etapa_abandono = 'FORM_PROSPECT'` |

---

## AÃ§Ãµes PossÃ­veis

| AÃ§Ã£o | Trigger | Resultado |
|------|---------|-----------|
| Criar Lead | FormulÃ¡rio submetido | Lead status `NOVO` no CRM |
| Notificar Parceiro | Lead criado | Webhook POST (se configurado) |
| Redirecionar | Lead criado | Navega para redirect_url (se configurado) |
| Bloquear | Token invÃ¡lido/expirado | Erro 401/403 |
| Rate Limit | Excede 100 leads/hora | Erro 429 (Too Many Requests) |

---

## Wireframe Conceitual

### FormulÃ¡rio Embarcado (Tema Light)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ›¡ï¸ PROTEÃ‡ÃƒO VEICULAR TOPBRASIL                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Solicite uma cotaÃ§Ã£o gratuita!                         â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Nome Completo *                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Telefone com DDD *                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ (__)_____-____                              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  E-mail *                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         ğŸš—  QUERO UMA COTAÃ‡ÃƒO                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Powered by TopBrasil â€¢ PolÃ­tica de Privacidade         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tela de Sucesso

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚                    âœ… PRONTO!                           â”‚
â”‚                                                         â”‚
â”‚   Recebemos sua solicitaÃ§Ã£o de cotaÃ§Ã£o.                 â”‚
â”‚                                                         â”‚
â”‚   Em breve um consultor entrarÃ¡ em contato              â”‚
â”‚   pelo telefone informado.                              â”‚
â”‚                                                         â”‚
â”‚   ğŸ“± Fique atento ao WhatsApp!                          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## GestÃ£o de Parceiros

### Cadastro de Parceiro

| Campo | Tipo | ObrigatÃ³rio | DescriÃ§Ã£o |
|-------|------|-------------|-----------|
| Nome do Parceiro | text | Sim | Nome comercial |
| CNPJ/CPF | text | Sim | Documento do parceiro |
| DomÃ­nios Autorizados | array | Sim | URLs onde o embed pode ser usado |
| E-mail de Contato | email | Sim | Para notificaÃ§Ãµes |
| Webhook URL | url | NÃ£o | Para notificaÃ§Ã£o de leads |
| Redirect URL | url | NÃ£o | Redirecionamento pÃ³s-envio |
| Token | uuid | Auto | Gerado automaticamente |
| Status | enum | Auto | ATIVO, INATIVO, SUSPENSO |

### Tabela de Origem Atualizada

| CÃ³digo | Origem | DescriÃ§Ã£o |
|--------|--------|-----------|
| ... | ... | ... |
| 12 | `FORMULARIO_EMBARCADO` | Lead captado via formulÃ¡rio embarcado em site de parceiro |

---

## MÃ©tricas Capturadas

| Dado | DescriÃ§Ã£o | Uso AnalÃ­tico |
|------|-----------|---------------|
| `cod_origem` | Sempre 12 para embarcado | Identificar canal |
| `cod_parceiro` | ID do parceiro | Comissionamento e performance |
| `dominio_origem` | DomÃ­nio de onde veio o lead | AnÃ¡lise de fontes |
| `ddd_telefone` | DDD extraÃ­do | AnÃ¡lise regional |
| `data_criacao` | Timestamp | AnÃ¡lise temporal |
| `tempo_preenchimento` | Segundos para preencher | UX do formulÃ¡rio |

---

## API Endpoints

### POST /api/v1/leads/embed

**Request:**
```json
{
  "token": "abc123xyz",
  "lead": {
    "nome": "JoÃ£o da Silva",
    "telefone": "11999999999",
    "email": "joao@email.com"
  },
  "meta": {
    "domain": "parceiro.com.br",
    "page_url": "https://parceiro.com.br/cotacao",
    "user_agent": "Mozilla/5.0..."
  }
}
```

**Response Success (201):**
```json
{
  "success": true,
  "lead_id": "uuid-do-lead",
  "message": "Lead criado com sucesso",
  "redirect_url": "https://parceiro.com/obrigado"
}
```

**Response Error (401):**
```json
{
  "success": false,
  "error": "TOKEN_INVALID",
  "message": "Token de parceiro invÃ¡lido"
}
```

---

## DefiniÃ§Ã£o de Pronto

- [ ] Endpoint POST /api/v1/leads/embed funcionando
- [ ] ValidaÃ§Ã£o de token de parceiro implementada
- [ ] CORS configurado por domÃ­nio de parceiro
- [ ] Iframe responsivo criado e testado
- [ ] Widget JavaScript criado e testado
- [ ] ValidaÃ§Ã£o de telefone contra blacklist funcionando
- [ ] ExtraÃ§Ã£o de DDD implementada
- [ ] Webhook de notificaÃ§Ã£o funcionando
- [ ] Redirecionamento pÃ³s-envio funcionando
- [ ] Rate limiting implementado (100 leads/hora)
- [ ] CRUD de parceiros implementado (admin)
- [ ] DocumentaÃ§Ã£o de integraÃ§Ã£o para parceiros
- [ ] Testes de integraÃ§Ã£o realizados

---

## DependÃªncias

| DependÃªncia | Tipo | Status |
|-------------|------|--------|
| US-CRM-LEAD-001 | Interna | âœ… DisponÃ­vel |
| Blacklist de Consultores | Interna | âœ… DisponÃ­vel |
| Sistema de Tokens (JWT/UUID) | Interna | Pendente |
| Cadastro de Parceiros | Interna | Pendente |
| Infraestrutura CORS | Interna | Pendente |

---

## IntegraÃ§Ãµes Futuras

| IntegraÃ§Ã£o | DescriÃ§Ã£o | Prioridade |
|------------|-----------|------------|
| Google Tag Manager | Eventos de conversÃ£o | Importante |
| Facebook Pixel | Tracking de conversÃ£o | Importante |
| Programa de Afiliados | Comissionamento | DesejÃ¡vel |

---

**Criado por**: Gustavo Titoneli (Product Owner)  
**Data**: 23/01/2026  
**VersÃ£o**: 1.0

**HistÃ³rico de AlteraÃ§Ãµes:**
| VersÃ£o | Data | AlteraÃ§Ã£o |
|--------|------|----------|
| 1.0 | 23/01/2026 | VersÃ£o inicial |
